---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Button from '../../components/Button.astro';

// This function is required for dynamic routes in static site generation
export function getStaticPaths() {
  // Define the photo data inside getStaticPaths
  const photoData = {
    'spiral-galaxy-m51': {
      title: 'Spiral Galaxy M51',
      description: 'Also known as the Whirlpool Galaxy, M51 is a classic spiral galaxy located in the constellation Canes Venatici. This image was captured using a 12-inch telescope with a specialized astrophotography camera over 8 hours of total exposure time.',
      src: '/photography/galaxy1.jpg',
      date: 'June 2023',
      location: 'Atacama Desert, Chile',
      equipment: 'Celestron EdgeHD 1100, ZWO ASI2600MM Pro',
      exposure: '48 x 10 minutes (8 hours total)',
      processing: 'PixInsight, Adobe Photoshop',
      category: 'Galaxies',
      related: ['orion-nebula', 'milky-way-core']
    },
    'orion-nebula': {
      title: 'Orion Nebula',
      description: 'The Orion Nebula (M42) is a diffuse nebula situated in the Milky Way, being south of Orion\'s Belt in the constellation of Orion. It is one of the brightest nebulae and is visible to the naked eye in the night sky.',
      src: '/photography/nebula1.jpg',
      date: 'January 2023',
      location: 'La Palma, Spain',
      equipment: 'Takahashi FSQ-106ED, Sony A7III (modified)',
      exposure: '32 x 5 minutes (2.7 hours total)',
      processing: 'PixInsight, Adobe Photoshop',
      category: 'Nebulae',
      related: ['spiral-galaxy-m51', 'northern-lights']
    },
    'star-trails': {
      title: 'Star Trails over Mountains',
      description: 'This long exposure captures the apparent motion of stars as Earth rotates. The image was taken over several hours in the Sierra Nevada mountains.',
      src: '/photography/stars1.jpg',
      date: 'August 2022',
      location: 'Sierra Nevada, USA',
      equipment: 'Canon EOS R5, 16-35mm f/2.8L',
      exposure: '240 x 30 seconds (2 hours total)',
      processing: 'Adobe Lightroom, StarStaX',
      category: 'Stars',
      related: ['milky-way-core', 'northern-lights']
    },
    'full-moon': {
      title: 'Full Moon Detail',
      description: 'A high-resolution image of the full moon showing incredible surface detail of craters, maria, and other lunar features.',
      src: '/photography/moon1.jpg',
      date: 'October 2022',
      location: 'Home Observatory',
      equipment: 'Celestron C11, ZWO ASI290MM',
      exposure: 'Mosaic of 20 panels, 2000 frames each',
      processing: 'AutoStakkert, Adobe Photoshop',
      category: 'Planets',
      related: ['jupiter-moons', 'solar-eclipse']
    },
    'northern-lights': {
      title: 'Northern Lights',
      description: 'The aurora borealis dancing over the Icelandic landscape. This rare display was captured during a geomagnetic storm.',
      src: '/photography/aurora1.jpg',
      date: 'March 2023',
      location: 'Iceland',
      equipment: 'Sony A7S III, 14mm f/1.8 GM',
      exposure: '8 seconds, ISO 6400',
      processing: 'Adobe Lightroom',
      category: 'Phenomena',
      related: ['star-trails', 'milky-way-core']
    },
    'milky-way-core': {
      title: 'Milky Way Core',
      description: 'The galactic core of our Milky Way galaxy rising over Death Valley. The dark sky conditions allowed for exceptional detail in this wide-field image.',
      src: '/photography/milkyway1.jpg',
      date: 'July 2022',
      location: 'Death Valley, USA',
      equipment: 'Nikon Z7, 24mm f/1.4',
      exposure: '15 x 20 seconds, ISO 3200',
      processing: 'Adobe Lightroom, Starry Landscape Stacker',
      category: 'Galaxies',
      related: ['spiral-galaxy-m51', 'northern-lights']
    },
    'solar-eclipse': {
      title: 'Total Solar Eclipse',
      description: 'A composite image showing the progression of a total solar eclipse, with the corona visible during totality.',
      src: '/photography/eclipse1.jpg',
      date: 'April 2023',
      location: 'Australia',
      equipment: 'Canon EOS R3, 100-400mm f/4.5-5.6L with solar filter',
      exposure: 'Various exposures during different phases',
      processing: 'Adobe Photoshop',
      category: 'Phenomena',
      related: ['full-moon', 'jupiter-moons']
    },
    'astrophotography-setup': {
      title: 'Astrophotography Setup',
      description: 'My portable deep-sky imaging setup featuring a computerized mount, refractor telescope, and dedicated astronomy camera.',
      src: '/photography/telescope1.jpg',
      date: 'May 2022',
      location: 'Home Observatory',
      equipment: 'Featured in image',
      category: 'Equipment',
      related: ['spiral-galaxy-m51', 'orion-nebula']
    },
    'jupiter-moons': {
      title: 'Jupiter and its Moons',
      description: 'A high-resolution image of Jupiter showing cloud bands, the Great Red Spot, and several of its largest moons.',
      src: '/photography/planets1.jpg',
      date: 'September 2022',
      location: 'Home Observatory',
      equipment: 'Celestron EdgeHD 8, ZWO ASI224MC',
      exposure: '10,000 frames, best 20% stacked',
      processing: 'AutoStakkert, RegiStax, Adobe Photoshop',
      category: 'Planets',
      related: ['full-moon', 'solar-eclipse']
    }
  };
  
  // Get all the photo slugs from the photoData object
  const slugs = Object.keys(photoData);
  
  // Return an array of objects with params and props
  return slugs.map(slug => {
    return {
      params: { slug },
      props: { photo: photoData[slug], photoData } // Pass photoData to props
    };
  });
}

// Get the photo data from props
const { slug } = Astro.params;
const { photo, photoData } = Astro.props;

// Get related photos
const relatedPhotos = photo.related
  .map(relatedSlug => {
    const relatedPhoto = photoData[relatedSlug];
    return relatedPhoto ? {
      slug: relatedSlug,
      title: relatedPhoto.title,
      src: relatedPhoto.src,
      category: relatedPhoto.category
    } : null;
  })
  .filter(Boolean);
---

<BaseLayout>
  <article class="photo-detail">
    <!-- Hero section with large photo -->
    <div class="relative h-[70vh] min-h-[500px] overflow-hidden">
      <img 
        src={photo.src} 
        alt={photo.title} 
        class="w-full h-full object-cover"
      />
      <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-black/30"></div>
      
      <!-- Back button -->
      <a href="/photography" class="absolute top-6 left-6 z-10 flex items-center text-white/90 hover:text-white transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
        </svg>
        Back to Gallery
      </a>
      
      <!-- Photo title and basic info -->
      <div class="absolute bottom-0 left-0 right-0 p-6 md:p-10 text-white">
        <div class="max-w-5xl mx-auto">
          <h1 class="text-3xl md:text-5xl font-bold mb-4">{photo.title}</h1>
          <div class="flex flex-wrap items-center text-white/80 text-sm md:text-base gap-x-6 gap-y-2">
            {photo.date && (
              <div class="flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
                </svg>
                {photo.date}
              </div>
            )}
            
            {photo.location && (
              <div class="flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
                </svg>
                {photo.location}
              </div>
            )}
            
            {photo.category && (
              <div class="flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414 0l-7-7A.997.997 0 012 10V5a3 3 0 013-3h5c.256 0 .512.098.707.293l7 7zM5 6a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
                </svg>
                {photo.category}
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
    
    <!-- Photo details section -->
    <div class="max-w-5xl mx-auto px-4 py-12 md:py-20">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-12">
        <!-- Left column: Description -->
        <div class="md:col-span-2">
          <h2 class="text-2xl font-semibold mb-6 text-[var(--apple-gray-900)] dark:text-white">About this Photo</h2>
          <p class="text-lg leading-relaxed text-[var(--apple-gray-700)] dark:text-[var(--apple-gray-300)] mb-8">
            {photo.description}
          </p>
          
          <!-- Share buttons -->
          <div class="flex items-center space-x-4 mt-8">
            <span class="text-sm font-medium text-[var(--apple-gray-500)]">Share:</span>
            <a href={`https://twitter.com/intent/tweet?text=${encodeURIComponent(photo.title)}&url=${encodeURIComponent(`https://adrianciencia.github.io/photography/${slug}`)}`} target="_blank" rel="noopener noreferrer" class="text-[var(--apple-gray-600)] dark:text-[var(--apple-gray-400)] hover:text-[var(--apple-blue)]">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                <path d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z"/>
              </svg>
            </a>
            <a href={`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(`https://adrianciencia.github.io/photography/${slug}`)}`} target="_blank" rel="noopener noreferrer" class="text-[var(--apple-gray-600)] dark:text-[var(--apple-gray-400)] hover:text-[var(--apple-blue)]">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                <path d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951z"/>
              </svg>
            </a>
            <a href={`mailto:?subject=${encodeURIComponent(`Check out this photo: ${photo.title}`)}&body=${encodeURIComponent(`I thought you might like this photo: https://adrianciencia.github.io/photography/${slug}`)}`} class="text-[var(--apple-gray-600)] dark:text-[var(--apple-gray-400)] hover:text-[var(--apple-blue)]">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4Zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1H2Zm13 2.383-4.708 2.825L15 11.105V5.383Zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741ZM1 11.105l4.708-2.897L1 5.383v5.722Z"/>
              </svg>
            </a>
          </div>
        </div>
        
        <!-- Right column: Technical details -->
        <div class="bg-[var(--apple-gray-50)] dark:bg-[var(--apple-gray-800)] p-6 rounded-2xl">
          <h3 class="text-lg font-semibold mb-4 text-[var(--apple-gray-900)] dark:text-white">Technical Details</h3>
          
          <dl class="space-y-4">
            {photo.equipment && (
              <div>
                <dt class="text-sm font-medium text-[var(--apple-gray-500)] dark:text-[var(--apple-gray-400)]">Equipment</dt>
                <dd class="mt-1 text-[var(--apple-gray-900)] dark:text-white">{photo.equipment}</dd>
              </div>
            )}
            
            {photo.exposure && (
              <div>
                <dt class="text-sm font-medium text-[var(--apple-gray-500)] dark:text-[var(--apple-gray-400)]">Exposure</dt>
                <dd class="mt-1 text-[var(--apple-gray-900)] dark:text-white">{photo.exposure}</dd>
              </div>
            )}
            
            {photo.processing && (
              <div>
                <dt class="text-sm font-medium text-[var(--apple-gray-500)] dark:text-[var(--apple-gray-400)]">Processing</dt>
                <dd class="mt-1 text-[var(--apple-gray-900)] dark:text-white">{photo.processing}</dd>
              </div>
            )}
          </dl>
          
          <!-- Download button -->
          <div class="mt-8">
            <a 
              href={photo.src}
              download
              class="inline-flex items-center justify-center w-full px-4 py-2 text-sm font-medium text-white bg-[var(--apple-blue)] rounded-lg hover:bg-[var(--apple-blue)]/90 transition-colors"
            >
              Download Full Resolution
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-2" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
              </svg>
            </a>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Related photos section -->
    {relatedPhotos.length > 0 && (
      <div class="bg-[var(--apple-gray-50)] dark:bg-[var(--apple-gray-800)] py-12 md:py-20 mt-12">
        <div class="max-w-7xl mx-auto px-4">
          <h2 class="text-2xl font-semibold mb-8 text-[var(--apple-gray-900)] dark:text-white">You Might Also Like</h2>
          
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            {relatedPhotos.map(relatedPhoto => (
              <a href={`/photography/${relatedPhoto.slug}`} class="group">
                <div class="bg-white dark:bg-[var(--apple-gray-900)] rounded-2xl overflow-hidden shadow-sm hover:shadow-md transition-shadow">
                  <div class="aspect-video bg-gray-100 dark:bg-gray-800 overflow-hidden">
                    <img 
                      src={relatedPhoto.src} 
                      alt={relatedPhoto.title} 
                      class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
                    />
                  </div>
                  <div class="p-4">
                    <h3 class="font-medium text-[var(--apple-gray-900)] dark:text-white group-hover:text-[var(--apple-blue)] transition-colors">{relatedPhoto.title}</h3>
                    {relatedPhoto.category && (
                      <p class="text-sm text-[var(--apple-gray-500)] dark:text-[var(--apple-gray-400)]">{relatedPhoto.category}</p>
                    )}
                  </div>
                </div>
              </a>
            ))}
          </div>
        </div>
      </div>
    )}
  </article>
</BaseLayout>

<style>
  /* Add smooth transitions for a more Apple-like feel */
  .photo-detail img {
    transition: transform 0.8s cubic-bezier(0.25, 0.1, 0.25, 1);
  }
  
  /* Add a subtle zoom effect when the page loads */
  @keyframes photoReveal {
    from {
      transform: scale(1.05);
      filter: blur(5px);
    }
    to {
      transform: scale(1);
      filter: blur(0);
    }
  }
  
  .photo-detail > div:first-child img {
    animation: photoReveal 1.2s cubic-bezier(0.25, 0.1, 0.25, 1) forwards;
  }
  
  <!-- For the Jupiter photo specifically, ensure proper containment -->
  {photo.title === 'Jupiter and its Moons' && (
  <style>
    /* Add specific containment for Jupiter photo to prevent hover issues */
    .photo-detail img {
      contain: content;
    }
    
    /* Ensure overlays don't extend beyond boundaries */
    .photo-detail .absolute {
      pointer-events: none;
    }
    
    /* But allow buttons and links to receive events */
    .photo-detail a, 
    .photo-detail button {
      pointer-events: auto;
    }
  </style>
)}
</style>